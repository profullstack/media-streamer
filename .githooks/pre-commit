#!/bin/sh
# BitTorrented.com Pre-commit Hook
# Runs security audit and GitHub Actions locally via act before every commit

echo "ğŸ” Running security audit..."
pnpm audit --audit-level=critical
AUDIT_EXIT_CODE=$?

if [ $AUDIT_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "âŒ CRITICAL security vulnerabilities found! Please fix before committing."
    exit 1
fi

echo "âœ… No critical security vulnerabilities found"
echo ""
echo "ğŸ”¨ Running pre-commit checks via act..."
echo ""

act
ACT_EXIT_CODE=$?

if [ $ACT_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "âŒ act failed! Please fix issues before committing."
    exit 1
fi

echo ""
echo "ğŸš€ Pre-commit checks complete. Proceeding with commit..."

#!/bin/sh
# BitTorrented.com Pre-commit Hook
# Enforces TDD by running lint, TypeScript check, build, and tests before every commit

echo "ğŸ”¨ Running pre-commit checks..."
echo ""

# Run lint
echo "ğŸ” Running lint..."
pnpm lint
LINT_EXIT_CODE=$?

if [ $LINT_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "âŒ Lint failed! Please fix lint errors before committing."
    exit 1
fi

echo ""
echo "âœ… Lint passed!"
echo ""

# Run TypeScript check
echo "ğŸ“ Running TypeScript check..."
pnpm tsc --noEmit
TSC_EXIT_CODE=$?

if [ $TSC_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "âŒ TypeScript check failed! Please fix type errors before committing."
    exit 1
fi

echo ""
echo "âœ… TypeScript check passed!"
echo ""

# Run build
echo "ğŸ“¦ Building application..."
pnpm build
BUILD_EXIT_CODE=$?

if [ $BUILD_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "âŒ Build failed! Please fix build errors before committing."
    exit 1
fi

echo ""
echo "âœ… Build successful!"
echo ""

# Run tests
echo "ğŸ§ª Running tests..."
pnpm test
TEST_EXIT_CODE=$?

if [ $TEST_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "âŒ Tests failed! Please fix failing tests before committing."
    exit 1
fi

echo ""
echo "âœ… All tests passed!"
echo ""
echo "ğŸš€ Pre-commit checks complete. Proceeding with commit..."
